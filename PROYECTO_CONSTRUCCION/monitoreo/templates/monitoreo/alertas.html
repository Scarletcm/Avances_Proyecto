{% extends "monitoreo/base.html" %}

{% block title %}Alertas - Sistema de Monitoreo{% endblock %}
{% block page_title %}Panel de Alertas{% endblock %}

{% block extra_css %}
<style>
    /* Estilos para panel de alertas */
    .alerts-container {
        margin-bottom: 2rem;
    }

    /* Barra de filtros y b√∫squeda */
    .alerts-toolbar {
        background: white;
        padding: 1.5rem;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        margin-bottom: 2rem;
        display: grid;
        grid-template-columns: 1fr 1fr 1fr 1fr;
        gap: 1rem;
        align-items: end;
    }

    .filter-group {
        display: flex;
        flex-direction: column;
    }

    .filter-label {
        font-size: 0.85rem;
        font-weight: 600;
        color: var(--text-dark);
        margin-bottom: 0.5rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .form-input,
    .form-select {
        padding: 0.75rem;
        border: 1px solid var(--border-color);
        border-radius: 6px;
        font-size: 0.9rem;
        transition: all 0.3s ease;
    }

    .form-select {
        cursor: pointer;
        appearance: none;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%231e3a8a' d='M1 4l5 5 5-5'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 8px center;
        padding-right: 2rem;
    }

    .form-input:focus,
    .form-select:focus {
        outline: none;
        border-color: var(--secondary-color);
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .search-btn {
        padding: 0.75rem 1.5rem;
        background: var(--secondary-color);
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
        width: 100%;
    }

    .search-btn:hover {
        background: var(--primary-color);
        transform: translateY(-2px);
    }

    /* Indicadores de estado de alertas */
    .alerts-summary {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin-bottom: 2rem;
    }

    .summary-card {
        background: white;
        padding: 1.5rem;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        text-align: center;
        border-top: 4px solid var(--secondary-color);
        transition: all 0.3s ease;
    }

    .summary-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
    }

    .summary-card.danger {
        border-top-color: var(--danger-color);
    }

    .summary-card.warning {
        border-top-color: var(--warning-color);
    }

    .summary-card.success {
        border-top-color: var(--success-color);
    }

    .summary-value {
        font-size: 2rem;
        font-weight: 700;
        color: var(--primary-color);
        margin-bottom: 0.5rem;
    }

    .summary-label {
        font-size: 0.85rem;
        text-transform: uppercase;
        color: var(--text-light);
        letter-spacing: 0.5px;
    }

    /* Lista de alertas */
    .alerts-list {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    /* Tarjeta de alerta */
    .alert-card {
        background: white;
        border-radius: 10px;
        padding: 1.5rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        border-left: 5px solid var(--danger-color);
        transition: all 0.3s ease;
        animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
        from {
            opacity: 0;
            transform: translateX(-20px);
        }
        to {
            opacity: 1;
            transform: translateX(0);
        }
    }

    .alert-card:hover {
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        transform: translateX(5px);
    }

    .alert-card.warning {
        border-left-color: var(--warning-color);
    }

    .alert-card.info {
        border-left-color: var(--secondary-color);
    }

    .alert-card.success {
        border-left-color: var(--success-color);
    }

    /* Cabecera de la alerta */
    .alert-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 1rem;
    }

    .alert-title-section {
        flex: 1;
    }

    .alert-badge {
        display: inline-block;
        padding: 0.35rem 0.75rem;
        background: rgba(220, 38, 38, 0.1);
        color: var(--danger-color);
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 700;
        text-transform: uppercase;
        margin-bottom: 0.5rem;
    }

    .alert-badge.warning {
        background: rgba(245, 158, 11, 0.1);
        color: var(--warning-color);
    }

    .alert-badge.info {
        background: rgba(59, 130, 246, 0.1);
        color: var(--secondary-color);
    }

    .alert-badge.success {
        background: rgba(16, 185, 129, 0.1);
        color: var(--success-color);
    }

    .alert-title {
        font-size: 1.1rem;
        font-weight: 700;
        color: var(--text-dark);
        margin-bottom: 0.25rem;
    }

    .alert-time {
        font-size: 0.8rem;
        color: var(--text-light);
    }

    .alert-actions {
        display: flex;
        gap: 0.5rem;
        flex-direction: column;
    }

    .action-btn {
        padding: 0.5rem 1rem;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 0.8rem;
        font-weight: 600;
        transition: all 0.3s ease;
    }

    .action-btn.primary {
        background: var(--secondary-color);
        color: white;
    }

    .action-btn.primary:hover {
        background: var(--primary-color);
    }

    .action-btn.danger {
        background: var(--danger-color);
        color: white;
    }

    .action-btn.danger:hover {
        background: #b91c1c;
    }

    /* Contenido de la alerta */
    .alert-content {
        margin-bottom: 1rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid var(--border-color);
    }

    .alert-detail {
        display: flex;
        gap: 1rem;
        margin-bottom: 0.75rem;
    }

    .alert-detail-label {
        font-weight: 600;
        color: var(--text-dark);
        min-width: 120px;
    }

    .alert-detail-value {
        color: var(--text-dark);
        flex: 1;
    }

    /* Severity level indicator */
    .severity-indicator {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.35rem 0.75rem;
        border-radius: 6px;
        font-size: 0.85rem;
        font-weight: 600;
    }

    .severity-indicator.critical {
        background: rgba(220, 38, 38, 0.1);
        color: var(--danger-color);
    }

    .severity-indicator.high {
        background: rgba(245, 158, 11, 0.1);
        color: var(--warning-color);
    }

    .severity-indicator.medium {
        background: rgba(59, 130, 246, 0.1);
        color: var(--secondary-color);
    }

    .severity-indicator.low {
        background: rgba(16, 185, 129, 0.1);
        color: var(--success-color);
    }

    .severity-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        animation: pulse 2s infinite;
    }

    @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
    }

    /* Estado de la alerta */
    .alert-status {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.85rem;
        font-weight: 600;
    }

    .status-badge {
        padding: 0.35rem 0.75rem;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 700;
        text-transform: uppercase;
    }

    .status-badge.active {
        background: rgba(220, 38, 38, 0.1);
        color: var(--danger-color);
    }

    .status-badge.resolved {
        background: rgba(16, 185, 129, 0.1);
        color: var(--success-color);
    }

    .status-badge.pending {
        background: rgba(245, 158, 11, 0.1);
        color: var(--warning-color);
    }

    /* Pie de la alerta */
    .alert-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 0.85rem;
        color: var(--text-light);
    }

    .alert-location {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .alert-actions-footer {
        display: flex;
        gap: 0.75rem;
    }

    /* Modal de detalle de alerta */
    .modal {
        display: none;
        position: fixed;
        z-index: 2000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(4px);
    }

    .modal.active {
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .modal-content {
        background: white;
        padding: 2rem;
        border-radius: 10px;
        box-shadow: 0 20px 25px rgba(0, 0, 0, 0.2);
        max-width: 600px;
        width: 90%;
        max-height: 80vh;
        overflow-y: auto;
    }

    .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
        padding-bottom: 1rem;
        border-bottom: 2px solid var(--border-color);
    }

    .modal-title {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--primary-color);
    }

    .modal-close {
        background: none;
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
        color: var(--text-light);
    }

    .modal-close:hover {
        color: var(--text-dark);
    }

    /* Responsividad */
    @media (max-width: 1024px) {
        .alerts-toolbar {
            grid-template-columns: 1fr 1fr;
        }
    }

    @media (max-width: 768px) {
        .alerts-toolbar {
            grid-template-columns: 1fr;
        }

        .alerts-summary {
            grid-template-columns: 1fr 1fr;
        }

        .alert-header {
            flex-direction: column;
            gap: 1rem;
        }

        .alert-actions {
            flex-direction: row;
        }

        .alert-footer {
            flex-direction: column;
            gap: 0.75rem;
        }
    }

    @media (max-width: 480px) {
        .alerts-toolbar {
            grid-template-columns: 1fr;
        }

        .alerts-summary {
            grid-template-columns: 1fr;
        }

        .alert-detail {
            flex-direction: column;
        }

        .alert-detail-label {
            min-width: 100%;
        }
    }

    /* Estado vac√≠o */
    .empty-state {
        text-align: center;
        padding: 3rem 1rem;
        background: white;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .empty-icon {
        font-size: 3rem;
        margin-bottom: 1rem;
        opacity: 0.5;
    }

    .empty-title {
        font-size: 1.25rem;
        font-weight: 600;
        color: var(--text-dark);
        margin-bottom: 0.5rem;
    }

    .empty-description {
        color: var(--text-light);
        margin-bottom: 1.5rem;
    }

    /* Paginaci√≥n */
    .pagination {
        display: flex;
        justify-content: center;
        gap: 0.5rem;
        margin-top: 2rem;
    }

    .pagination-btn {
        padding: 0.5rem 0.75rem;
        border: 1px solid var(--border-color);
        background: white;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 500;
    }

    .pagination-btn:hover,
    .pagination-btn.active {
        background: var(--secondary-color);
        color: white;
        border-color: var(--secondary-color);
    }

    .pagination-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }
</style>
{% endblock %}

{% block content %}
<div class="animate-fade">
    <!-- Barra de herramientas y filtros -->
    <div class="alerts-toolbar">
        <div class="filter-group">
            <label class="filter-label">üîç Buscar Alerta</label>
            <input
                type="text"
                class="form-input"
                placeholder="N√∫mero de alerta, ubicaci√≥n..."
                id="searchInput"
            >
        </div>

        <div class="filter-group">
            <label class="filter-label">üìä Nivel de Severidad</label>
            <select class="form-select" id="severityFilter">
                <option value="">Todos los niveles</option>
                <option value="critical">üî¥ Cr√≠tico</option>
                <option value="high">üü† Alto</option>
                <option value="medium">üü° Medio</option>
                <option value="low">üü¢ Bajo</option>
            </select>
        </div>

        <div class="filter-group">
            <label class="filter-label">üìç Estado de Alerta</label>
            <select class="form-select" id="statusFilter">
                <option value="">Todos los estados</option>
                <option value="active">üî¥ Activa</option>
                <option value="resolved">‚úì Resuelta</option>
                <option value="pending">‚è≥ Pendiente</option>
            </select>
        </div>

        <button class="search-btn" onclick="applyFilters()">
            üîç Filtrar Alertas
        </button>
    </div>

    <!-- Resumen de alertas (RF-03: Estado de alertas) -->
    <div class="alerts-summary">
        <div class="summary-card danger">
            <div class="summary-value">5</div>
            <div class="summary-label">Alertas Activas</div>
        </div>

        <div class="summary-card warning">
            <div class="summary-value">12</div>
            <div class="summary-label">Hoy Generadas</div>
        </div>

        <div class="summary-card success">
            <div class="summary-value">8</div>
            <div class="summary-label">Resueltas (Hoy)</div>
        </div>

        <div class="summary-card">
            <div class="summary-value">94%</div>
            <div class="summary-label">Tasa de Respuesta</div>
        </div>
    </div>

    <!-- LISTA DE ALERTAS GENERADAS (RF-03) -->
    <div class="alerts-container">
        <div class="alerts-list" id="alertsList">
            <!-- Alerta 1: Activa - Cr√≠tica -->
            <div class="alert-card">
                <div class="alert-header">
                    <div class="alert-title-section">
                        <span class="alert-badge">Cr√≠tica</span>
                        <div class="alert-title">üö® Comportamiento sospechoso detectado - ALERTA #001</div>
                        <div class="alert-time">‚è∞ Hace 2 minutos | 14:35:22</div>
                    </div>
                    <div class="alert-actions">
                        <button class="action-btn primary" onclick="viewAlertDetails(1)">üëÅÔ∏è Detalles</button>
                        <button class="action-btn danger" onclick="resolveAlert(1)">‚úì Resolver</button>
                    </div>
                </div>

                <div class="alert-content">
                    <div class="alert-detail">
                        <div class="alert-detail-label">üìç Ubicaci√≥n:</div>
                        <div class="alert-detail-value">Avenida Principal, Zona Centro (C√°mara #5)</div>
                    </div>

                    <div class="alert-detail">
                        <div class="alert-detail-label">üéØ Comportamiento:</div>
                        <div class="alert-detail-value">Movimiento err√°tico en zona de acceso restringido</div>
                    </div>

                    <div class="alert-detail">
                        <div class="alert-detail-label">üìä Severidad:</div>
                        <div class="alert-detail-value">
                            <span class="severity-indicator critical">
                                <span class="severity-dot"></span>
                                Cr√≠tica
                            </span>
                        </div>
                    </div>

                    <div class="alert-detail">
                        <div class="alert-detail-label">üìà Confiabilidad:</div>
                        <div class="alert-detail-value">
                            <div style="background: var(--border-color); height: 6px; border-radius: 3px; overflow: hidden;">
                                <div style="background: var(--danger-color); width: 92%; height: 100%;"></div>
                            </div>
                            92%
                        </div>
                    </div>
                </div>

                <div class="alert-footer">
                    <div class="alert-location">
                        üìç Centro Urbano
                    </div>
                    <div class="alert-actions-footer">
                        <span class="status-badge active">Activa</span>
                    </div>
                </div>
            </div>

            <!-- Alerta 2: Activa - Alta -->
            <div class="alert-card warning">
                <div class="alert-header">
                    <div class="alert-title-section">
                        <span class="alert-badge warning">Alta</span>
                        <div class="alert-title">‚ö†Ô∏è Aproximaci√≥n furtiva detectada - ALERTA #002</div>
                        <div class="alert-time">‚è∞ Hace 15 minutos | 14:20:15</div>
                    </div>
                    <div class="alert-actions">
                        <button class="action-btn primary" onclick="viewAlertDetails(2)">üëÅÔ∏è Detalles</button>
                        <button class="action-btn danger" onclick="resolveAlert(2)">‚úì Resolver</button>
                    </div>
                </div>

                <div class="alert-content">
                    <div class="alert-detail">
                        <div class="alert-detail-label">üìç Ubicaci√≥n:</div>
                        <div class="alert-detail-value">Calle Norte, Zona Comercial (C√°mara #8)</div>
                    </div>

                    <div class="alert-detail">
                        <div class="alert-detail-label">üéØ Comportamiento:</div>
                        <div class="alert-detail-value">Acercamiento lento y furtivo a zona con valor comercial</div>
                    </div>

                    <div class="alert-detail">
                        <div class="alert-detail-label">üìä Severidad:</div>
                        <div class="alert-detail-value">
                            <span class="severity-indicator high">
                                <span class="severity-dot"></span>
                                Alta
                            </span>
                        </div>
                    </div>

                    <div class="alert-detail">
                        <div class="alert-detail-label">üìà Confiabilidad:</div>
                        <div class="alert-detail-value">
                            <div style="background: var(--border-color); height: 6px; border-radius: 3px; overflow: hidden;">
                                <div style="background: var(--warning-color); width: 78%; height: 100%;"></div>
                            </div>
                            78%
                        </div>
                    </div>
                </div>

                <div class="alert-footer">
                    <div class="alert-location">
                        üìç Zona Comercial
                    </div>
                    <div class="alert-actions-footer">
                        <span class="status-badge active">Activa</span>
                    </div>
                </div>
            </div>

            <!-- Alerta 3: Resuelta -->
            <div class="alert-card success">
                <div class="alert-header">
                    <div class="alert-title-section">
                        <span class="alert-badge success">Baja</span>
                        <div class="alert-title">‚ÑπÔ∏è Actividad an√≥mala reportada - ALERTA #003</div>
                        <div class="alert-time">‚è∞ Hace 45 minutos | 13:50:00</div>
                    </div>
                    <div class="alert-actions">
                        <button class="action-btn primary" onclick="viewAlertDetails(3)">üëÅÔ∏è Detalles</button>
                    </div>
                </div>

                <div class="alert-content">
                    <div class="alert-detail">
                        <div class="alert-detail-label">üìç Ubicaci√≥n:</div>
                        <div class="alert-detail-value">Parque Central (C√°mara #3)</div>
                    </div>

                    <div class="alert-detail">
                        <div class="alert-detail-label">üéØ Comportamiento:</div>
                        <div class="alert-detail-value">Aglomeraci√≥n de personas en √°rea sin vigilancia habitual</div>
                    </div>

                    <div class="alert-detail">
                        <div class="alert-detail-label">üìä Severidad:</div>
                        <div class="alert-detail-value">
                            <span class="severity-indicator low">
                                <span class="severity-dot" style="animation: none;"></span>
                                Baja
                            </span>
                        </div>
                    </div>

                    <div class="alert-detail">
                        <div class="alert-detail-label">üìà Confiabilidad:</div>
                        <div class="alert-detail-value">
                            <div style="background: var(--border-color); height: 6px; border-radius: 3px; overflow: hidden;">
                                <div style="background: var(--success-color); width: 55%; height: 100%;"></div>
                            </div>
                            55%
                        </div>
                    </div>

                    <div class="alert-detail">
                        <div class="alert-detail-label">‚úì Resuelto:</div>
                        <div class="alert-detail-value">Confirmado como evento normal. Personal identific√≥ grupo de trabajadores.</div>
                    </div>
                </div>

                <div class="alert-footer">
                    <div class="alert-location">
                        üìç Zona P√∫blica
                    </div>
                    <div class="alert-actions-footer">
                        <span class="status-badge resolved">Resuelta</span>
                    </div>
                </div>
            </div>

            <!-- Alerta 4: Pendiente -->
            <div class="alert-card info">
                <div class="alert-header">
                    <div class="alert-title-section">
                        <span class="alert-badge info">Media</span>
                        <div class="alert-title">‚è≥ Alertas pendiente de revisi√≥n - ALERTA #004</div>
                        <div class="alert-time">‚è∞ Hace 1 hora | 13:35:45</div>
                    </div>
                    <div class="alert-actions">
                        <button class="action-btn primary" onclick="viewAlertDetails(4)">üëÅÔ∏è Detalles</button>
                        <button class="action-btn danger" onclick="resolveAlert(4)">‚úì Resolver</button>
                    </div>
                </div>

                <div class="alert-content">
                    <div class="alert-detail">
                        <div class="alert-detail-label">üìç Ubicaci√≥n:</div>
                        <div class="alert-detail-value">Estacionamiento Sur (C√°mara #12)</div>
                    </div>

                    <div class="alert-detail">
                        <div class="alert-detail-label">üéØ Comportamiento:</div>
                        <div class="alert-detail-value">Manipulaci√≥n de objetos cerca de veh√≠culos</div>
                    </div>

                    <div class="alert-detail">
                        <div class="alert-detail-label">üìä Severidad:</div>
                        <div class="alert-detail-value">
                            <span class="severity-indicator medium">
                                <span class="severity-dot"></span>
                                Media
                            </span>
                        </div>
                    </div>
                </div>

                <div class="alert-footer">
                    <div class="alert-location">
                        üìç Zona de Veh√≠culos
                    </div>
                    <div class="alert-actions-footer">
                        <span class="status-badge pending">Pendiente</span>
                    </div>
                </div>
            </div>

            <!-- Alerta 5: Activa -->
            <div class="alert-card">
                <div class="alert-header">
                    <div class="alert-title-section">
                        <span class="alert-badge">Cr√≠tica</span>
                        <div class="alert-title">üö® Intento de acceso no autorizado - ALERTA #005</div>
                        <div class="alert-time">‚è∞ Hace 3 minutos | 14:32:18</div>
                    </div>
                    <div class="alert-actions">
                        <button class="action-btn primary" onclick="viewAlertDetails(5)">üëÅÔ∏è Detalles</button>
                        <button class="action-btn danger" onclick="resolveAlert(5)">‚úì Resolver</button>
                    </div>
                </div>

                <div class="alert-content">
                    <div class="alert-detail">
                        <div class="alert-detail-label">üìç Ubicaci√≥n:</div>
                        <div class="alert-detail-value">Puerta trasera, Almac√©n (C√°mara #15)</div>
                    </div>

                    <div class="alert-detail">
                        <div class="alert-detail-label">üéØ Comportamiento:</div>
                        <div class="alert-detail-value">Persona intentando abrir puerta de acceso restringido</div>
                    </div>

                    <div class="alert-detail">
                        <div class="alert-detail-label">üìä Severidad:</div>
                        <div class="alert-detail-value">
                            <span class="severity-indicator critical">
                                <span class="severity-dot"></span>
                                Cr√≠tica
                            </span>
                        </div>
                    </div>

                    <div class="alert-detail">
                        <div class="alert-detail-label">üìà Confiabilidad:</div>
                        <div class="alert-detail-value">
                            <div style="background: var(--border-color); height: 6px; border-radius: 3px; overflow: hidden;">
                                <div style="background: var(--danger-color); width: 89%; height: 100%;"></div>
                            </div>
                            89%
                        </div>
                    </div>
                </div>

                <div class="alert-footer">
                    <div class="alert-location">
                        üìç √Årea Restringida
                    </div>
                    <div class="alert-actions-footer">
                        <span class="status-badge active">Activa</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Paginaci√≥n -->
    <div class="pagination">
        <button class="pagination-btn active">1</button>
        <button class="pagination-btn">2</button>
        <button class="pagination-btn">3</button>
        <span style="margin: 0 1rem; align-self: center;">...</span>
        <button class="pagination-btn">‚Üí</button>
    </div>
</div>

<!-- Modal de detalles de alerta -->
<div class="modal" id="detailsModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 class="modal-title" id="modalTitle">Detalles de Alerta</h2>
            <button class="modal-close" onclick="closeModal()">‚úï</button>
        </div>

        <div id="modalBody">
            <!-- Contenido din√°mico -->
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 1.5rem;">
            <button class="btn btn-secondary" onclick="closeModal()">Cerrar</button>
            <button class="btn btn-danger" onclick="resolveAlertModal()">Resolver Alerta</button>
        </div>
    </div>
</div>

<!-- JavaScript -->
<script>
    /**
     * RF-03: Generar alerta autom√°tica - Panel de Alertas
     * Visualizaci√≥n de alertas generadas con estado
     */

    function applyFilters() {
        const searchText = document.getElementById('searchInput').value.toLowerCase();
        const severity = document.getElementById('severityFilter').value;
        const status = document.getElementById('statusFilter').value;

        console.log(`Filtros aplicados - B√∫squeda: ${searchText}, Severidad: ${severity}, Estado: ${status}`);
        alert(`Filtros aplicados:\nB√∫squeda: ${searchText}\nSeveridad: ${severity || 'Todas'}\nEstado: ${status || 'Todos'}`);
    }

    /**
     * Ver detalles de una alerta
     */
    function viewAlertDetails(alertId) {
        const modal = document.getElementById('detailsModal');
        const alertDetails = {
            1: {
                title: 'ALERTA #001 - Comportamiento sospechoso',
                tipo: 'Cr√≠tica',
                ubicacion: 'Avenida Principal, Zona Centro (C√°mara #5)',
                comportamiento: 'Movimiento err√°tico en zona de acceso restringido',
                confiabilidad: '92%',
                timestamp: '14:35:22',
                respuesta: 'Pendiente de respuesta del personal de monitoreo',
                detalles: 'El sistema detect√≥ un patr√≥n de movimiento an√≥malo. La persona se mueve de manera err√°tica cerca de una zona restringida. Se recomienda respuesta inmediata.'
            },
            2: {
                title: 'ALERTA #002 - Aproximaci√≥n furtiva',
                tipo: 'Alta',
                ubicacion: 'Calle Norte, Zona Comercial (C√°mara #8)',
                comportamiento: 'Acercamiento lento y furtivo',
                confiabilidad: '78%',
                timestamp: '14:20:15',
                respuesta: 'Pendiente de verificaci√≥n en campo',
                detalles: 'Se detect√≥ aproximaci√≥n cautelosa a zona de valor comercial. Personal de monitoreo debe verificar.'
            },
            3: {
                title: 'ALERTA #003 - Actividad an√≥mala',
                tipo: 'Baja',
                ubicacion: 'Parque Central (C√°mara #3)',
                comportamiento: 'Aglomeraci√≥n de personas',
                confiabilidad: '55%',
                timestamp: '13:50:00',
                respuesta: '‚úì Resuelta - Evento normal',
                detalles: 'Confirmado como evento normal. Personal identific√≥ grupo de trabajadores en actividad de mantenimiento.'
            },
            4: {
                title: 'ALERTA #004 - Manipulaci√≥n de objetos',
                tipo: 'Media',
                ubicacion: 'Estacionamiento Sur (C√°mara #12)',
                comportamiento: 'Manipulaci√≥n de objetos cerca de veh√≠culos',
                confiabilidad: '65%',
                timestamp: '13:35:45',
                respuesta: 'Pendiente de revisi√≥n',
                detalles: 'Actividad sospechosa cercana a veh√≠culos. Requiere revisi√≥n visual.'
            },
            5: {
                title: 'ALERTA #005 - Intento de acceso',
                tipo: 'Cr√≠tica',
                ubicacion: 'Puerta trasera, Almac√©n (C√°mara #15)',
                comportamiento: 'Intento de abrir puerta restringida',
                confiabilidad: '89%',
                timestamp: '14:32:18',
                respuesta: 'Requiere respuesta inmediata',
                detalles: 'Sistema detect√≥ intento de acceso no autorizado. Se recomienda activaci√≥n de protocolo de emergencia.'
            }
        };

        const alert = alertDetails[alertId];
        const modalBody = document.getElementById('modalBody');

        modalBody.innerHTML = `
            <div class="alert-detail">
                <div class="alert-detail-label">Tipo de Alerta:</div>
                <div class="alert-detail-value">${alert.tipo}</div>
            </div>

            <div class="alert-detail">
                <div class="alert-detail-label">üìç Ubicaci√≥n:</div>
                <div class="alert-detail-value">${alert.ubicacion}</div>
            </div>

            <div class="alert-detail">
                <div class="alert-detail-label">üéØ Comportamiento:</div>
                <div class="alert-detail-value">${alert.comportamiento}</div>
            </div>

            <div class="alert-detail">
                <div class="alert-detail-label">üìà Confiabilidad:</div>
                <div class="alert-detail-value">${alert.confiabilidad}</div>
            </div>

            <div class="alert-detail">
                <div class="alert-detail-label">‚è∞ Hora de Detecci√≥n:</div>
                <div class="alert-detail-value">${alert.timestamp}</div>
            </div>

            <div class="alert-detail">
                <div class="alert-detail-label">üìã Descripci√≥n:</div>
                <div class="alert-detail-value">${alert.detalles}</div>
            </div>

            <div class="alert-detail">
                <div class="alert-detail-label">‚úì Estado:</div>
                <div class="alert-detail-value">${alert.respuesta}</div>
            </div>
        `;

        document.getElementById('modalTitle').textContent = alert.title;
        modal.classList.add('active');
    }

    /**
     * Cerrar modal
     */
    function closeModal() {
        document.getElementById('detailsModal').classList.remove('active');
    }

    /**
     * Resolver alerta
     */
    function resolveAlert(alertId) {
        if (confirm(`¬øMarcar ALERTA #${String(alertId).padStart(3, '0')} como resuelta?`)) {
            alert('‚úì Alerta marcada como resuelta.\nRegistro actualizado en la base de datos (RF-05).');
        }
    }

    /**
     * Resolver alerta desde modal
     */
    function resolveAlertModal() {
        alert('‚úì Alerta resuelta correctamente.');
        closeModal();
    }

    // Inicializar
    document.addEventListener('DOMContentLoaded', function() {
        console.log('Panel de Alertas inicializado');
        console.log('RF-03: Generar alerta autom√°tica - Panel de visualizaci√≥n activo');
        updateNotificationBadge(5);
    });

    // Cerrar modal al presionar Escape
    document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape') {
            closeModal();
        }
    });
</script>
{% endblock %}
