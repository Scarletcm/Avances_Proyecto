{% extends "monitoreo/base.html" %}

{% block title %}Estad√≠sticas - Sistema de Monitoreo{% endblock %}
{% block page_title %}Dashboard de Estad√≠sticas y An√°lisis por Zonas{% endblock %}

{% block extra_css %}
<style>
    /* Estilos para estad√≠sticas */
    .stats-filters {
        background: white;
        padding: 1.5rem;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        margin-bottom: 2rem;
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        align-items: end;
    }

    .filter-group {
        display: flex;
        flex-direction: column;
    }

    .filter-label {
        font-size: 0.85rem;
        font-weight: 600;
        color: var(--text-dark);
        margin-bottom: 0.5rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .form-input,
    .form-select {
        padding: 0.75rem;
        border: 1px solid var(--border-color);
        border-radius: 6px;
        font-size: 0.9rem;
        transition: all 0.3s ease;
    }

    .form-select {
        cursor: pointer;
        appearance: none;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%231e3a8a' d='M1 4l5 5 5-5'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 8px center;
        padding-right: 2rem;
    }

    .form-input:focus,
    .form-select:focus {
        outline: none;
        border-color: var(--secondary-color);
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .action-btn {
        padding: 0.75rem 1.5rem;
        background: var(--secondary-color);
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
        width: 100%;
    }

    .action-btn:hover {
        background: var(--primary-color);
        transform: translateY(-2px);
    }

    /* Tarjetas de resumen */
    .summary-cards {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 1rem;
        margin-bottom: 2rem;
    }

    .summary-card {
        background: white;
        padding: 1.8rem;
        border-radius: 12px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        border-top: 5px solid var(--secondary-color);
        text-align: center;
        min-height: 160px;
    }

    .summary-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
    }

    .summary-card.danger {
        border-top-color: var(--danger-color);
    }

    .summary-card.warning {
        border-top-color: var(--warning-color);
    }

    .summary-card.success {
        border-top-color: var(--success-color);
    }

    .card-value {
        font-size: 2rem;
        font-weight: 800;
        color: var(--primary-color);
        margin-bottom: 0.3rem;
    }

    .card-label {
        font-size: 1.1rem;
        text-transform: uppercase;
        color: var(--text-light);
        font-weight: 700;
        margin-bottom: 1rem;
    }


    .card-trend {
        font-size: 0.95rem;
        font-weight: 600;
    }

    .card-trend.negative {
        color: var(--danger-color);
    }

    /* Secci√≥n de gr√°ficos */
    .charts-section {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
        gap: 2rem;
        margin-bottom: 2rem;
    }

    .chart-card {
        background: white;
        padding: 1.5rem;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .chart-title {
        font-size: 1.25rem;
        font-weight: 600;
        color: var(--primary-color);
        margin-bottom: 1.5rem;
        padding-bottom: 1rem;
        border-bottom: 2px solid var(--border-color);
    }

    /* Gr√°fico de barras simulado */
    .bar-chart {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .bar-item {
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .bar-label {
        min-width: 120px;
        font-weight: 500;
        color: var(--text-dark);
        font-size: 0.9rem;
    }

    .bar-container {
        flex: 1;
        height: 30px;
        background: var(--light-bg);
        border-radius: 4px;
        overflow: hidden;
        position: relative;
    }

    .bar-fill {
        height: 100%;
        background: linear-gradient(90deg, var(--secondary-color) 0%, var(--primary-color) 100%);
        display: flex;
        align-items: center;
        justify-content: flex-end;
        padding-right: 0.5rem;
        color: white;
        font-size: 0.75rem;
        font-weight: 700;
    }

    .bar-fill.danger {
        background: linear-gradient(90deg, var(--danger-color) 0%, #b91c1c 100%);
    }

    .bar-fill.warning {
        background: linear-gradient(90deg, var(--warning-color) 0%, #d97706 100%);
    }

    .bar-fill.success {
        background: linear-gradient(90deg, var(--success-color) 0%, #059669 100%);
    }

    .bar-value {
        min-width: 60px;
        text-align: right;
        font-weight: 700;
        color: var(--primary-color);
        font-size: 0.95rem;
    }

    /* Mapa de ubicaciones (RF-04) */
    .map-container {
        background: white;
        padding: 1.5rem;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        margin-bottom: 2rem;
    }

    .map-title {
        font-size: 1.25rem;
        font-weight: 600;
        color: var(--primary-color);
        margin-bottom: 1.5rem;
        padding-bottom: 1rem;
        border-bottom: 2px solid var(--border-color);
    }

    .map-simulation {
        width: 100%;
        height: 400px;
        background: linear-gradient(135deg, #e0e7ff 0%, #f3f4f6 100%);
        border: 2px solid var(--border-color);
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 1.5rem;
        position: relative;
        overflow: hidden;
    }

    .map-grid {
        position: absolute;
        width: 100%;
        height: 100%;
        background-image:
            linear-gradient(rgba(59, 130, 246, 0.1) 1px, transparent 1px),
            linear-gradient(90deg, rgba(59, 130, 246, 0.1) 1px, transparent 1px);
        background-size: 50px 50px;
    }

    .map-marker {
        position: absolute;
        width: 35px;
        height: 35px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    }

    .map-marker:hover {
        transform: scale(1.2);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }

    .map-marker.high-risk {
        background: var(--danger-color);
        animation: pulse 2s infinite;
    }

    .map-marker.medium-risk {
        background: var(--warning-color);
    }

    .map-marker.low-risk {
        background: var(--success-color);
    }

    .map-marker-label {
        position: absolute;
        bottom: -25px;
        background: var(--primary-color);
        color: white;
        padding: 0.35rem 0.75rem;
        border-radius: 4px;
        font-size: 0.75rem;
        font-weight: 600;
        white-space: nowrap;
        opacity: 0;
        transition: all 0.3s ease;
    }

    .map-marker:hover .map-marker-label {
        opacity: 1;
        bottom: -35px;
    }

    @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
    }

    /* Leyenda del mapa */
    .map-legend {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 1rem;
    }

    .legend-item {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        font-size: 0.9rem;
    }

    .legend-color {
        width: 20px;
        height: 20px;
        border-radius: 50%;
    }

    /* Tabla de zonas con estad√≠sticas (RF-06) */
    .zones-table-container {
        background: white;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        margin-bottom: 2rem;
        overflow: hidden;
    }

    .table-header {
        padding: 1.5rem;
        background: var(--light-bg);
        border-bottom: 2px solid var(--border-color);
    }

    .table-title {
        font-size: 1.25rem;
        font-weight: 600;
        color: var(--primary-color);
    }

    .table-wrapper {
        overflow-x: auto;
    }

    table {
        width: 100%;
        border-collapse: collapse;
    }

    thead {
        background: var(--light-bg);
        border-bottom: 2px solid var(--border-color);
    }

    th {
        padding: 1rem;
        text-align: left;
        font-weight: 600;
        color: var(--text-dark);
        font-size: 0.9rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    td {
        padding: 1rem;
        border-bottom: 1px solid var(--border-color);
        font-size: 0.9rem;
    }

    tbody tr:hover {
        background: rgba(59, 130, 246, 0.05);
    }

    /* Badges para zonas */
    .zone-badge {
        display: inline-block;
        padding: 0.35rem 0.75rem;
        border-radius: 6px;
        font-size: 0.8rem;
        font-weight: 600;
        text-transform: uppercase;
    }

    .badge-high {
        background: rgba(220, 38, 38, 0.1);
        color: var(--danger-color);
    }

    .badge-medium {
        background: rgba(245, 158, 11, 0.1);
        color: var(--warning-color);
    }

    .badge-low {
        background: rgba(16, 185, 129, 0.1);
        color: var(--success-color);
    }

    /* Tendencia */
    .trend-indicator {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.9rem;
        font-weight: 600;
    }

    .trend-up {
        color: var(--danger-color);
    }

    .trend-down {
        color: var(--success-color);
    }

    .trend-stable {
        color: var(--text-light);
    }

    /* Porcentaje visual */
    .percentage-bar {
        width: 100%;
        height: 6px;
        background: var(--border-color);
        border-radius: 3px;
        overflow: hidden;
        margin-top: 0.5rem;
    }

    .percentage-fill {
        height: 100%;
        background: linear-gradient(90deg, var(--secondary-color) 0%, var(--primary-color) 100%);
    }

    /* Pie chart simulado */
    .pie-chart {
        width: 250px;
        height: 250px;
        border-radius: 50%;
        background: conic-gradient(
            var(--danger-color) 0deg 129.6deg,
            var(--warning-color) 129.6deg 237.6deg,
            var(--success-color) 237.6deg 360deg
        );
        margin: 1rem auto;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .pie-legend {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 1rem;
        text-align: center;
        margin-top: 1.5rem;
    }

    .pie-item {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        font-size: 0.85rem;
    }

    .pie-color {
        width: 12px;
        height: 12px;
        border-radius: 2px;
    }

    /* Responsividad */
    @media (max-width: 1024px) {
        .charts-section {
            grid-template-columns: 1fr;
        }

        .map-simulation {
            height: 300px;
        }
    }

    @media (max-width: 768px) {
        .stats-filters {
            grid-template-columns: 1fr 1fr;
        }

        .summary-cards {
            grid-template-columns: 1fr 1fr;
        }

        .map-legend {
            grid-template-columns: 1fr;
        }

        table {
            font-size: 0.8rem;
        }

        th, td {
            padding: 0.75rem;
        }
    }

    @media (max-width: 480px) {
        .summary-cards {
            grid-template-columns: 1fr;
        }

        .card-value {
            font-size: 1.75rem;
        }

        .map-simulation {
            height: 250px;
        }

        .pie-chart {
            width: 200px;
            height: 200px;
        }
    }

    /* Grid de fondo */
    .insights-section {
        background: white;
        padding: 1.5rem;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        margin-bottom: 2rem;
    }

    .insights-title {
        font-size: 1.25rem;
        font-weight: 600;
        color: var(--primary-color);
        margin-bottom: 1.5rem;
        padding-bottom: 1rem;
        border-bottom: 2px solid var(--border-color);
    }

    .insights-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 1.5rem;
    }

    .insight-item {
        padding: 1rem;
        background: var(--light-bg);
        border-left: 4px solid var(--secondary-color);
        border-radius: 6px;
    }

    .insight-item.critical {
        border-left-color: var(--danger-color);
    }

    .insight-item.warning {
        border-left-color: var(--warning-color);
    }

    .insight-title {
        font-weight: 600;
        color: var(--text-dark);
        margin-bottom: 0.5rem;
    }

    .insight-description {
        font-size: 0.9rem;
        color: var(--text-dark);
    }
</style>
{% endblock %}

{% block content %}
<div class="animate-fade">




    <!-- Filtros para estad√≠sticas -->
    <form method="get" class="stats-filters">

        <div class="filter-group">
            <label class="filter-label">üìÖ Rango de Fechas</label>
            <select class="form-select" name="rango">
                <option value="today">Hoy</option>
                <option value="week">Esta semana</option>
                <option value="month">Este mes</option>
                <option value="year">Este a√±o</option>
            </select>
        </div>

        <div class="filter-group">
            <label class="filter-label">üìç Zona</label>
            <select class="form-select" name="zona">
                <option value="">Todas las zonas</option>
                <option value="centro">Centro Urbano</option>
                <option value="comercial">Zona Comercial</option>
                <option value="publica">Zona P√∫blica</option>
                <option value="vehiculos">Zona de Veh√≠culos</option>
                <option value="restringida">√Årea Restringida</option>
            </select>
        </div>

        <div class="filter-group">
            <label class="filter-label">üìä Tipo de An√°lisis</label>
            <select class="form-select" name="tipo">
                <option value="all">Todos los eventos</option>
                <option value="suspicious">Solo sospechosos</option>
                <option value="normal">Solo normales</option>
            </select>
        </div>

        <button type="submit" class="action-btn">
            üìä Actualizar An√°lisis
        </button>

    </form>

</div>



    <!-- Resumen de estad√≠sticas principales -->



   <div class="summary-cards">
    <div class="summary-card">
       <div class="card-value">{{ resumen.total_eventos }}</div>
       <div class="card-label">Total Eventos (Mes)</div>
       <div class="card-trend">‚Üë 15% respecto a mes anterior</div>
    </div>

    <div class="summary-card danger">
        <div class="card-value">{{ resumen.eventos_sospechosos }}</div>
        <div class="card-label">Eventos Sospechosos</div>
        <div class="card-trend negative">‚Üë 23% respecto a mes anterior</div>
    </div>

    <div class="summary-card warning">
        <div class="card-value">8</div>
        <div class="card-label">Zona de mayor riesgo</div>
        <div class="card-trend" style="color: var(--primary-color)">Centro Urbano</div>
    </div>

    <div class="summary-card success">
        <div class="card-value">{{ resumen.tasa_resolucion }}</div>
        <div class="card-label">Tasa de resoluci√≥n</div>
        <div class="card-trend">‚Üë 3% respecto a mes anterior</div>
    </div>
</div>

<div class="charts-section">
    <div class="chart-card">
        <div class="chart-title">üìä Eventos por Zona</div>
        {% for z in zonas.values %}
        <div class="bar-item">
            <div class="bar-label">{{ z.nombre }}</div>
            <div class="bar-container">
                <div class="bar-fill
                    {% if z.riesgo == 'Cr√≠tico' %}danger
                    {% elif z.riesgo == 'Alto' %}warning
                    {% else %}success{% endif %}"
                    style="width:{% widthratio z.eventos resumen.total_eventos 100 %}%;">
                    {{ z.eventos }}
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <div class="chart-card">
      <div class="chart-title">üéØ Distribuci√≥n de Severidad</div>
      <div style="text-align: center;">
        <div class="pie-chart"
          style="
            --critica: {{ severidad.critica }};
            --alta: {{ severidad.alta }};
            --normal: {{ severidad.normal }};
          ">
        </div>
        <div class="pie-legend">
          <div class="pie-item">
            <div class="pie-color" style="background: var(--danger-color);"></div>
            <span>Cr√≠tica ({{ severidad.critica }}%)</span>
          </div>
          <div class="pie-item">
            <div class="pie-color" style="background: var(--warning-color);"></div>
            <span>Alta ({{ severidad.alta }}%)</span>
          </div>
          <div class="pie-item">
            <div class="pie-color" style="background: var(--success-color);"></div>
            <span>Normal ({{ severidad.normal }}%)</span>
          </div>
        </div>
      </div>
    </div>
</div> <div class="map-container">
    <div class="map-title">üìç Mapa de Ubicaci√≥n de Incidentes</div>
    <div class="map-simulation">
        <div class="map-grid"></div>
        <div class="map-marker high-risk" style="top: 25%; left: 35%;" onclick="viewZoneDetails('centro')">
            üìç <div class="map-marker-label">Centro (85 eventos)</div>
        </div>
        <div class="map-marker medium-risk" style="top: 50%; left: 70%;" onclick="viewZoneDetails('comercial')">
            üìç <div class="map-marker-label">Comercial (62)</div>
        </div>
        <div class="map-marker medium-risk" style="top: 70%; left: 45%;" onclick="viewZoneDetails('vehiculos')">
            üìç <div class="map-marker-label">Veh√≠culos (58)</div>
        </div>
        <div class="map-marker low-risk" style="top: 40%; left: 20%;" onclick="viewZoneDetails('publica')">
            üìç <div class="map-marker-label">P√∫blica (45)</div>
        </div>
        <div class="map-marker high-risk" style="top: 15%; left: 75%;" onclick="viewZoneDetails('restringida')">
            üìç <div class="map-marker-label">Restringida (35)</div>
        </div>
    </div>
    <div class="map-legend">
        <div class="legend-item"><div class="legend-color" style="background: var(--danger-color);"></div><span>Alto Riesgo (>70 eventos)</span></div>
        <div class="legend-item"><div class="legend-color" style="background: var(--warning-color);"></div><span>Riesgo Medio (40-70)</span></div>
        <div class="legend-item"><div class="legend-color" style="background: var(--success-color);"></div><span>Bajo Riesgo (<40)</span></div>
    </div>
</div>

<div class="zones-table-container">
    <div class="table-header">
        <div class="table-title">üìä Estad√≠sticas Detalladas por Zona</div>
    </div>
    <div class="table-wrapper">
        <table>
            <thead>
                <tr>
                    <th>üìç Zona</th>
                    <th>Total Eventos</th>
                    <th>Sospechosos</th>
                    <th>Normales</th>
                    <th>Nivel de Riesgo</th>
                    <th>Tendencia</th>
                    <th>Distribuci√≥n</th>
                </tr>
            </thead>
            <tbody>
                {% for zona in zonas.values %}
                <tr>
                    <td>{{ zona.nombre }}</td>
                    <td>{{ zona.eventos }}</td>
                    <td class="danger">{{ zona.sospechosos }}</td>
                    <td class="success">{{ zona.normales }}</td>
                    <td><span class="badge {{ zona.riesgo|lower }}">{{ zona.riesgo }}</span></td>
                    <td>
                        {% if zona.tendencia == 'up' %}<span class="trend up">‚¨Ü Aumento</span>
                        {% elif zona.tendencia == 'down' %}<span class="trend down">‚¨á Disminuci√≥n</span>
                        {% else %}<span class="trend stable">‚ûñ Estable</span>{% endif %}
                    </td>
                    <td>{% widthratio zona.eventos resumen.total_eventos 100 %}%</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<div class="insights-section">
    <div class="insights-title">üí° Insights y Recomendaciones</div>
    <div class="insights-grid">
        <div class="insight-item critical">
            <div class="insight-title">‚ö†Ô∏è Centro Urbano requiere atenci√≥n</div>
            <div class="insight-description">La zona Centro Urbano registra el mayor n√∫mero de eventos sospechosos (32).</div>
        </div>
        <div class="insight-item warning">
            <div class="insight-title">üìà Tendencia al alza en √Årea Restringida</div>
            <div class="insight-description">La √Årea Restringida muestra un aumento del 25% en incidentes.</div>
        </div>
        <div class="insight-item">
            <div class="insight-title">‚úì Zona P√∫blica bajo control</div>
            <div class="insight-description">La Zona P√∫blica muestra la tendencia m√°s favorable.</div>
        </div>
        <div class="insight-item critical">
            <div class="insight-title">üöó Incremento en robos de veh√≠culos</div>
            <div class="insight-description">La Zona de Veh√≠culos registra 22 eventos sospechosos.</div>
        </div>
        <div class="insight-item warning">
            <div class="insight-title">üìä Eficiencia de detecci√≥n</div>
            <div class="insight-description">El sistema detecta el 37.8% de eventos sospechosos.</div>
        </div>
        <div class="insight-item">
            <div class="insight-title">üìÖ An√°lisis temporal</div>
            <div class="insight-description">An√°lisis nocturno/diurno para identificar patrones espec√≠ficos.</div>
        </div>
    </div>
</div>
<!-- JavaScript -->
<script>
    /**
     * RF-06: Visualizar estad√≠sticas por zonas
     * RF-04: Mostrar ubicaci√≥n del incidente (mediante mapa)
     */

    const zoneDetails = {
        centro: {
            nombre: 'Centro Urbano',
            eventos: 85,
            sospechosos: 32,
            riesgo: 'Cr√≠tico',
            descripcion: 'Zona de alto tr√°nsito con mayor concentraci√≥n de personas y veh√≠culos. Mayor n√∫mero de incidentes registrados.'
        },
        comercial: {
            nombre: 'Zona Comercial',
            eventos: 62,
            sospechosos: 18,
            riesgo: 'Alto',
            descripcion: '√Årea con establecimientos comerciales. Riesgo moderado de eventos sospechosos.'
        },
        publica: {
            nombre: 'Zona P√∫blica',
            eventos: 45,
            sospechosos: 8,
            riesgo: 'Bajo',
            descripcion: '√Årea con espacios verdes y zonas recreativas. Baja incidencia de eventos an√≥malos.'
        },
        vehiculos: {
            nombre: 'Zona de Veh√≠culos',
            eventos: 58,
            sospechosos: 22,
            riesgo: 'Medio-Alto',
            descripcion: 'Estacionamientos y √°reas de circulaci√≥n vehicular. Riesgo moderado de actividades delictivas.'
        },
        restringida: {
            nombre: '√Årea Restringida',
            eventos: 35,
            sospechosos: 15,
            riesgo: 'Cr√≠tico',
            descripcion: 'Zona de acceso controlado. Cualquier evento es considerado de alto riesgo.'
        }
    };

    /**
     * RF-04: Mostrar ubicaci√≥n del incidente
     */
    function viewZoneDetails(zone) {
        const details = zoneDetails[zone];
        alert(
            `üìç ${details.nombre}\n\n` +
            `Total Eventos: ${details.eventos}\n` +
            `Eventos Sospechosos: ${details.sospechosos}\n` +
            `Nivel de Riesgo: ${details.riesgo}\n\n` +
            `Descripci√≥n:\n${details.descripcion}`
        );
    }

    /**
     * RF-06: Aplicar filtros a estad√≠sticas
     */
    function applyFilters() {
        const dateRange = document.getElementById('dateRange').value;
        const zone = document.getElementById('zoneFilter').value;
        const analysisType = document.getElementById('analysisType').value;

        console.log(`Filtros aplicados - Per√≠odo: ${dateRange}, Zona: ${zone || 'Todas'}, An√°lisis: ${analysisType}`);
        alert(
            `üìä An√°lisis actualizado\n\n` +
            `Per√≠odo: ${dateRange}\n` +
            `Zona: ${zone || 'Todas las zonas'}\n` +
            `Tipo: ${analysisType}\n\n` +
            `Datos actualizados correctamente.`
        );
    }

    // Inicializar
    document.addEventListener('DOMContentLoaded', function() {
        console.log('Dashboard de Estad√≠sticas inicializado');
        console.log('RF-06: Visualizar estad√≠sticas por zonas - Dashboard activo');
        console.log('RF-04: Mostrar ubicaci√≥n de incidente - Mapa de ubicaciones activo');
        updateNotificationBadge(5);
    });
</script>
{% endblock %}
<script>
fetch('/static/data/estadisticas.json')
  .then(response => response.json())
  .then(data => {

    const maxEventos = Math.max(...data.zonas.map(z => z.eventos));

    data.zonas.forEach(zona => {
      const id = zona.nombre
        .toLowerCase()
        .replace(/ /g, '-')
        .replace('√°','a');

      const porcentaje = (zona.eventos / maxEventos) * 100;

      const barra = document.getElementById(`zona-${id}`);
      const texto = document.getElementById(`zona-${id}-text`);

      if (barra && texto) {
        barra.style.width = porcentaje + '%';
        barra.innerText = zona.eventos;
        texto.innerText = `${zona.eventos} eventos`;
      }
    });

    document.getElementById('critica').innerText =
      `Cr√≠tica (${data.severidad.critica}%)`;
    document.getElementById('alta').innerText =
      `Alta (${data.severidad.alta}%)`;
    document.getElementById('normal').innerText =
      `Normal (${data.severidad.normal}%)`;
  });
</script>